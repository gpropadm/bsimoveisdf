// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
  }

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String?
  emailVerified DateTime?
  image         String?
  role          String    @default("admin")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  accounts Account[]
  sessions Session[]

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verificationtokens")
}

model Property {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique // SEO-friendly URL slug
  description String?
  price       Float
  type        String   // "venda" or "aluguel"
  status      String   @default("disponivel") // "disponivel", "vendido", "alugado"
  category    String   // "casa", "apartamento", "cobertura", etc.
  cep         String?  // CEP do imóvel
  address     String
  city        String
  state       String
  bedrooms    Int?
  bathrooms   Int?
  parking     Int?     // vagas de garagem
  area        Float?
  images      String?  // JSON string of image URLs
  video       String?  // URL do vídeo (YouTube, Vimeo, etc.)
  featured    Boolean  @default(false)
  
  // Campos específicos para apartamentos/coberturas
  floor       Int?     // andar do apartamento
  condoFee    Float?   // valor do condomínio
  amenities   String?  // JSON string com comodidades do condomínio
  
  // Campos específicos para terrenos
  zoning      String?  // zoneamento (residencial, comercial, industrial)
  slope       String?  // topografia (plano, aclive, declive)
  frontage    Float?   // frente do terreno (metros)
  
  // Campos específicos para fazendas
  totalArea   Float?   // área total da fazenda (hectares)
  cultivatedArea Float? // área cultivada (hectares)
  pastures    Float?   // área de pastagens (hectares)
  buildings   String?  // JSON string com benfeitorias da fazenda
  waterSources String? // fontes de água (rios, poços, açudes)
  
  // Campos específicos para casas
  houseType   String?  // tipo de casa (térrea, sobrado, condomínio)
  yard        Boolean? // quintal (sim/não)
  garage      String?  // tipo de garagem (coberta, descoberta, fechada)
  
  // Campos específicos para imóveis comerciais
  commercialType String? // tipo comercial (loja, sala, galpão, etc.)
  floor_commercial Int?  // andar (para salas comerciais)
  businessCenter String? // centro empresarial/shopping/prédio
  features      String?  // JSON com características comerciais
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  leads Lead[]
  appointments Appointment[]

  @@map("properties")
}

model Lead {
  id           String   @id @default(cuid())
  name         String
  email        String?
  phone        String?
  message      String?
  propertyId   String?  // referência opcional ao imóvel
  propertyTitle String? // título do imóvel para histórico
  propertyPrice Float?  // preço do imóvel para histórico
  propertyType String?  // tipo do imóvel (venda/aluguel)
  source       String   @default("site") // "site", "whatsapp", "telefone", etc.
  status       String   @default("novo") // "novo", "contatado", "interessado", "convertido", "perdido"
  notes        String?  // observações do corretor
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  property Property? @relation(fields: [propertyId], references: [id], onDelete: SetNull)
  appointments Appointment[]

  @@map("leads")
}

model Appointment {
  id          String   @id @default(cuid())
  propertyId  String
  leadId      String?  // Conecta com o sistema de leads existente
  
  // Participantes
  clientName    String
  clientEmail   String
  clientPhone   String
  realtorId     String?  // Futuro: sistema de corretores
  
  // Agendamento
  scheduledDate DateTime
  duration      Int      @default(60) // minutos
  status        String   @default("agendado") // "agendado", "confirmado", "cancelado", "concluído"
  
  // Notificações
  clientNotified    Boolean @default(false)
  realtorNotified   Boolean @default(false)
  ownerNotified     Boolean @default(false)
  
  // Feedback pós-visita
  clientFeedback    String?
  interestLevel     Int?     // 1-5
  
  // Localização para confirmação
  checkInTime       DateTime?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  lead     Lead?    @relation(fields: [leadId], references: [id], onDelete: SetNull)

  @@map("appointments")
}

model PropertySubmission {
  id            String   @id @default(cuid())
  
  // Informações do proprietário
  ownerName     String
  ownerEmail    String
  ownerPhone    String
  
  // Informações do imóvel
  title         String
  description   String?
  propertyType  String   // "casa", "apartamento", "cobertura", etc.
  saleType      String   // "venda", "aluguel"
  price         Float?
  address       String
  city          String
  state         String
  neighborhood  String?
  bedrooms      Int?
  bathrooms     Int?
  parking       Int?
  area          Float?
  
  // Status da submissão
  status        String   @default("pendente") // "pendente", "em_analise", "aprovado", "rejeitado", "publicado"
  adminNotes    String?  // Observações do admin
  
  // Preferências
  hasPhotos     Boolean  @default(false)
  acceptsVisits Boolean  @default(true)
  urgency       String   @default("normal") // "normal", "alta", "baixa"
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("property_submissions")
}

model PropertyRequest {
  id              String   @id @default(cuid())
  
  // Informações do solicitante
  clientName      String
  clientEmail     String
  clientPhone     String
  
  // Preferências do imóvel
  propertyType    String?  // "casa", "apartamento", "cobertura", etc.
  saleType        String   // "venda", "aluguel"
  priceMin        Float?
  priceMax        Float?
  city            String
  neighborhood    String?
  bedrooms        Int?
  bathrooms       Int?
  parking         Int?
  areaMin         Float?
  areaMax         Float?
  
  // Detalhes da solicitação
  description     String?  // Descrição detalhada do que procura
  timeline        String?  // "urgente", "1_mes", "3_meses", "6_meses", "sem_pressa"
  budget          String?  // "a_vista", "financiado", "fgts"
  
  // Status da solicitação
  status          String   @default("ativo") // "ativo", "atendido", "cancelado", "pausado"
  adminNotes      String?  // Observações do admin
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("property_requests")
}

model ContactMessage {
  id          String   @id @default(cuid())
  
  // Informações do contato
  name        String
  email       String
  phone       String?
  subject     String
  message     String
  
  // Contexto
  source      String   @default("site") // "site", "whatsapp", "telefone"
  referrer    String?  // URL de onde veio
  
  // Status
  status      String   @default("novo") // "novo", "lido", "respondido", "resolvido"
  adminNotes  String?  // Observações do admin
  respondedAt DateTime?
  respondedBy String?  // ID do admin que respondeu
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("contact_messages")
}

model Settings {
  id                   String  @id @default(cuid())
  siteName             String  @default("ImobiNext")
  siteDescription      String  @default("Encontre o imóvel dos seus sonhos")
  contactEmail         String  @default("contato@imobinext.com")
  contactPhone         String  @default("(48) 99864-5864")
  contactWhatsapp      String  @default("5548998645864")
  address              String  @default("Rua das Flores, 123")
  city                 String  @default("Florianópolis")
  state                String  @default("SC")
  socialFacebook       String  @default("https://facebook.com")
  socialInstagram      String  @default("https://instagram.com")
  socialLinkedin       String  @default("https://linkedin.com")
  featuredLimit        Int     @default(6)
  enableRegistrations  Boolean @default(true)
  enableComments       Boolean @default(false)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("settings")
}
